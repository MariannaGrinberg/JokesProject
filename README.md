# JokesProject
הפרויקט מדמה מערכת במבנה שרת-לקוח עבור בדיחות. דרך המערכת ניתן להוסיף בדיחה, לצפות בבדיחה רנדומלית מהמאגר ולדרג אותה ולצפות ב-5 הבדיחות בעלות הדירוג הגבוה ביותר. 
הוראות
להפעלת המערכת יש לפתוח שני חלונות cmd – אחד לשרת ואחד ללקוח ולהפעיל את erlang.
בחלון אחד יש להריץ את השרת ע"י הפונקציה jokesServer:start() המפעילה את השרת.
בחלון השני יש להריץ את הפונקציה jokesClient("Request") כאשר במקום Request שולחים את אחת מהאפשרויות הבאות:
add joke –הוספת בדיחה חדשה למאגר הבדיחות.
random joke – הצגת בדיחה רנדומלית מתוך המאגר, מתן אפשרות ללקוח לדרג את הבדיחה ושקלול הדירוג הממוצע של הבדיחה.
top 5 – הצגת 5 הבדיחות בעלות הדירוג הממוצע הגבוה ביותר.
מודולים מרכזיים
צד שרת
server(Port) – פונקציה אשר מאתחלת את השרת ואת מאגר הבדיחות הבסיסי הבנוי כרשימה המכילה בתוכה טופלים – האיבר הראשון בטופל הוא הבדיחה עצמו והאיבר השני בטופל הוא רשימה המכילה בתוכה את הדירוגים שהתקבלו עבור אותה בדיחה, ומפעילה את הפונקציה loop(Socket, Jokes) אשר מתחילה להאזין לבקשות המתקבלות מהלקוח.
loop(Socket, Jokes) – פונקציית ההאזנה והטיפול בפניות המתקבלות מהלקוח. הפונקציה מקבלת כל פעם את רשימת הבדיחות המעודכנת כדי לכלול שינויים כדוגמת בדיחה שנוספה או דירוג נוסף לבדיחה. הפונקציה מטפלת במקרים של הודעות מוגדרות, או במקרים של פקטות המכילות מידע מתחלף (תוכן של בדיחה חדשה או דירוג של בדיחה) מפרקת את הפקטה לסוג הודעה ולתוכן הרלוונטי. הפונקציה מטפלת גם במקרה בו ההודעה שהתקבלה אינה תקינה. המקרים השונים בהם מטפל השרת מופעלים כל אחד בתהליך נפרד כדי ליצור עבודה מקבילית. בתהליכים הנפרדים הללו מופעלות פונקציות העזר לביצוע הטיפול בבקשות:
add(Socket, Host, Port) – שולחת ללקוח הודעה שתפעיל אצל הלקוח קליטת בדיחה חדשה
newJoke(Jokes, Joke, Master) – הוספת בדיחה חדשה אל רשימת הבדיחות ושליחת הודעה עצמית (לתהליך עצמו של השרת) להחזרת הרשימה המעודכנת מהתהליך.
randomJoke(Socket, Host, Port, Jokes) – פונקציה הבוחרת באופן רנדומלי בדיחה מתוך הרשימה ושולחת כפקטה ללקוח.

jokeRate(Socket, Host, Port, Jokes, Msg, Master) – פונקציה המקבלת מהלקוח את הדירוג שלו לבדיחה הרנדומלית שקיבל, מוסיפה את הדירוג החדש לרשימת הדירוגים של אותה הבדיחה ושולחת ללקוח את הדירוג הממוצע החדש של הבדיחה. הפונקציה שולחת את רשימת הבדיחות החדשה המעודכנת עם הדירוג החדשה בתור הודעה עצמית לצורך עדכון.
getTop5(Socket, Host, Port, Jokes) – פונקציה אשר ממיינת את רשימת הבדיחות לפי הדירוג הממוצע של הבדיחה. הפונקציה יוצרת רשימה חדשה באמצעות פונקציה רקורסיבית – createList ומרכיבה רשימה של טופלים המורכבים מהבדיחה עצמה ומהדירוג הממוצע של הבדיחה. הפונקציה ממיינת את הרשימה על פי הדירוג הממוצע והופכת את הסדר כך שהרשימה תסודר מהגדול לקטן. הפונקציה יוצרת רשימה המכילה את חמשת המקומות הראשונים והופכת אותה ל-string כדי לאפשר שליחה ושולחת את ההודעה.
צד לקוח
client(Request) – פונקציה הפותחת Socket חדש עבור צד הלקוח, שולחת את הבקשה אל השרת, ממתינה לתשובה ומפעילה את הפונקציה receive_message לטיפול בתשובה שמתקבלת, סוגרת את ה-Socket ומחזירה את התשובה.
receive_message(Socket) – פונקציה המטפלת בתשובות אשר מתקבלות מהשרת ומגיעות אל הלקוח. הפונקציה מטפלת בהודעות מוגדרות, אך גם במקרים בהם ההודעות המתקבלות הן חלק מפקטה המכילה מספר פרטי מידע, ויש צורך לפרק את הפקטה ולהשתמש בחלקי המידע השונים. הפקטות הללו יהיו מורכבות מסוג ההודעה ומהמידע עצמו, לאחר פירוק וחיפוש המקרה המתאים לסוג ההודעה, ההודעה תטופל בהתאם. כלל ההודעות אשר מגיעות אל הלקוח מגיעות כ-string ויש להמיר אותן לסוג הרלוונטי במהלך הטיפול בהודעה. כמו כן, עבור הכנסת הדירוג ע"י הלקוח מתבצעת בדיקת תקינות שהקלט המתקבל הוא מספר שלם בלבד בין 1 ל-5.
הסבר התוצאות
הוספת בדיחה
פנייה מהלקוח -> קבלה בשרת ושליחת הודעה להכנסת בדיחה -> קבלה אצל הלקוח ושליחת הבדיחה -> קבלה בשרת והוספת הבדיחה החדשה למערך הבדיחות
הבדיחה החדשה הנשלחת מהלקוח מוכנסת אל מאגר הבדיחות והשרת ממשיך לפעול עם מאגר הבדיחות החדש.
בדיחה רנדומלית
פנייה מהלקוח -> קבלה בשרת, שליחת בדיחה רנדומלית ובקשה לדירוג -> קבלה אצל הלקוח, קבלת בדיחה ודירוגה -> קבלה בשרת, הוספת הדירוג לבדיחה ושליחת הדירוג הממוצע -> קבלה אצל הלקוח והצגת הדירוג הממוצע
הלקוח מקבל בדיחה רנדומלית אותה הוא נדרש לדרג, הדירוג החדש מתווסף למאגר והלקוח מקבל את הדירוג הממוצע של הבדיחה.
5 הבדיחות המוצלחות
פנייה מהלקוח -> קבלה בשרת, מיון המערך, הוצאת 5 הבדיחות המוצלחות ביותר עפ"י דירוג ושליחתן ללקוח -> קבלה אצל הלקוח והצגת הבדיחות
הלקוח מקבל את חמשת הבדיחות המוצלחות ביותר עפ"י הדירוג באותו רגע נתון (המערך ממשיך להתעדכן על סמך דירוגים ובדיחות חדשים)
